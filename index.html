<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0a0a0a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Usual Us - Our Love Story ü§ç</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect fill='%23ffc6d9' width='192' height='192'/><text x='96' y='120' font-size='140' text-anchor='middle' fill='%23000'>‚ù§Ô∏è</text></svg>">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- LOGIN SCREEN -->
    <div id="login-screen" class="hidden">
        <div class="login-container">
            <div class="app-title">Usual Us</div>
            <div class="app-subtitle">Our little corner of the internet ü§ç</div>

            <!-- First Login Form -->
            <form id="first-login-form" class="login-section">
                <div class="form-group">
                    <label for="user-id-input">User ID</label>
                    <input type="text" id="user-id-input" placeholder="Enter your ID (imsusu / imgugu)" required>
                </div>
                <div class="form-group">
                    <label for="pin-input">PIN</label>
                    <input type="password" id="pin-input" placeholder="Enter your PIN" required>
                </div>
                <button type="submit" class="btn-login">Login</button>
            </form>

            <!-- Returning Login Form -->
            <form id="returning-login-form" class="login-section hidden">
                <div class="welcome-back">Welcome back, <span id="returning-name"></span>!</div>
                <div class="form-group">
                    <label for="returning-pin-input">PIN</label>
                    <input type="password" id="returning-pin-input" placeholder="Enter your PIN" required>
                </div>
                <button type="submit" class="btn-login">Login</button>
                <button type="button" id="switch-user-btn" class="btn-switch">Switch User</button>
            </form>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="app" class="hidden">
        <!-- Header -->
        <div id="app-header">
            <div id="greeting">Good afternoon, Susu ü§ç</div>
        </div>

        <!-- Main Content -->
        <div id="main-content">
            <!-- HOME TAB -->
            <div id="home-tab" class="tab-content active">
                <!-- Balance Card -->
                <div class="balance-card">
                    <div class="balance-label">Current Balance</div>
                    <div class="balance-amount">‚Çπ<span id="balance-amount">0</span></div>
                    <div class="balance-status" id="balance-status">Even steven!</div>
                </div>

                <!-- Who Pays Next -->
                <div class="who-pays-next">
                    <div class="who-pays-label">Who pays next?</div>
                    <div class="who-pays-indicator" id="who-pays-indicator">ü§ù</div>
                </div>

                <!-- Budget Section (NEW - POSITIONED HERE) -->
                <div class="budget-progress-card" id="budget-card" style="display: none;">
                    <div class="budget-header">
                        <div class="budget-label">This Month's Budget</div>
                        <button type="button" id="edit-budget-btn" class="btn-edit-budget">‚úèÔ∏è</button>
                    </div>
                    <div class="budget-amount-display">
                        <span id="budget-spent">‚Çπ0</span>
                        <span class="budget-separator">/</span>
                        <span id="budget-total">‚Çπ0</span>
                    </div>
                    <div class="budget-progress-bar">
                        <div id="budget-progress-fill" class="budget-progress-fill" style="width: 0%"></div>
                    </div>
                    <div id="budget-warning" class="budget-warning" style="display: none;"></div>
                </div>

                <!-- Settle Up Button -->
                <button class="btn-settle" id="settle-btn">Settle Up ü§ù</button>

                <!-- Recent Expenses Section -->
                <div class="recent-section">
                    <h2>Recent Expenses</h2>
                    <div id="recent-expenses-list"></div>
                </div>
            </div>

            <!-- STATS TAB -->
            <div id="stats-tab" class="tab-content">
                <div id="stats-container">
                    <!-- This Month Card -->
                    <div class="card-section">
                        <h2>This Month</h2>
                        <div class="stats-card">
                            <div class="stat-item">
                                <div class="stat-label">Total Spent</div>
                                <div class="stat-value" id="stats-total-spent">‚Çπ0</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label" id="stats-my-name">Your Contribution</div>
                                <div class="stat-value" id="stats-my-contribution">‚Çπ0</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label" id="stats-partner-name">Partner Contribution</div>
                                <div class="stat-value" id="stats-partner-contribution">‚Çπ0</div>
                            </div>
                        </div>
                    </div>

                    <!-- By Category -->
                    <div class="card-section">
                        <h2>By Category</h2>
                        <div id="stats-by-category" class="category-stats">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <!-- Yearly Overview (Optional) -->
                    <div class="card-section">
                        <h2>Overall Stats</h2>
                        <div class="stats-card">
                            <div class="stat-item">
                                <div class="stat-label">Total Expenses (All Time)</div>
                                <div class="stat-value" id="stats-all-time">‚Çπ0</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Average Per Month</div>
                                <div class="stat-value" id="stats-avg-monthly">‚Çπ0</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- HISTORY TAB -->
            <div id="history-tab" class="tab-content">
                <div id="expenses-list">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- US TAB -->
            <div id="us-tab" class="tab-content">
                <div class="us-container">
                    <div class="us-header">
                        <h1 id="us-title">Us</h1>
                        <p class="us-subtitle">Our little corner of the internet</p>
                        <p class="days-counter" id="days-counter">Day 1 of us üíï</p>
                    </div>

                    <!-- Music Player (TOP-MIDDLE POSITIONED) -->
                    <div id="music-player-panel" class="music-player-panel">
                        <button id="close-music-player" class="btn-close-music">‚úï</button>
                        <div class="music-player-header">
                            <h3>Our Playlist üéµ</h3>
                        </div>
                        <select id="song-selector" class="song-selector">
                            <option value="">Select a song...</option>
                        </select>
                        <audio id="music-player" crossorigin="anonymous"></audio>
                        <div class="music-player-controls">
                            <button id="play-pause-btn" class="music-btn">‚ñ∂</button>
                            <div class="seek-container">
                                <span id="current-time">0:00</span>
                                <input type="range" id="seek-bar" class="seek-bar" min="0" max="100" value="0">
                                <span id="duration">0:00</span>
                            </div>
                        </div>
                    </div>

                    <!-- Polaroid Frame with Draggable Image -->
                    <div class="polaroid-section">
                        <div class="polaroid-frame" id="polaroid-frame">
                            <div class="polaroid-image-container">
                                <img id="polaroid-image" src="" alt="Our Memory" class="polaroid-image" draggable="true">
                                <div class="drag-hint" id="drag-hint">üìç Drag to position</div>
                            </div>
                            <div class="polaroid-text">
                                <p id="daily-quote" class="daily-quote">Still my favorite person</p>
                            </div>
                        </div>
                        <button id="music-player-toggle" class="btn-music-toggle">üéµ Play Music</button>
                        <button id="add-memory-btn" class="btn-add-memory">üì∏ Add Memory</button>
                    </div>

                    <!-- Memories Gallery -->
                    <div class="memories-section">
                        <h2>Our Memories üì∏</h2>
                        <div id="memories-grid" class="memories-grid">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <!-- Notes -->
                    <div class="notes-section">
                        <div class="notes-header">
                            <h2>Our Notes üíå</h2>
                            <button id="add-note-btn" class="btn-add-note">+ Add Note</button>
                        </div>
                        <div id="notes-list" class="notes-list">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div id="bottom-nav">
            <button class="nav-item active" data-tab="home">
                <div class="nav-icon">üè†</div>
                <div class="nav-label">Home</div>
            </button>
            <button class="nav-item" data-tab="stats">
                <div class="nav-icon">üìä</div>
                <div class="nav-label">Stats</div>
            </button>
            <button class="nav-item" data-tab="history">
                <div class="nav-icon">üìã</div>
                <div class="nav-label">History</div>
            </button>
            <button class="nav-item" data-tab="us">
                <div class="nav-icon">üíï</div>
                <div class="nav-label">Us</div>
            </button>
        </div>
    </div>

    <!-- MODALS -->

    <!-- Settle Modal -->
    <div id="settle-modal" class="modal hidden">
        <div class="modal-content">
            <div class="settle-content">
                <div class="settle-emoji">ü§ù</div>
                <h2>Settle Up?</h2>
                <p id="settle-message">Balance will be reset to ‚Çπ0</p>
                <p class="settle-hint">This records that debts are settled between you and your partner.</p>
            </div>
            <div class="settle-actions">
                <button id="confirm-settle-btn" class="btn-primary">Confirm Settle</button>
                <button id="cancel-settle-btn" class="btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Balance Celebration -->
    <div id="balance-celebration" class="modal hidden">
        <div class="modal-content">
            <div class="celebration-content">
                <div class="celebration-emoji">‚ú®</div>
                <h2>Balance is Settled!</h2>
                <p>You two are all square! üéâ</p>
            </div>
        </div>
    </div>

    <!-- Add/Edit Expense Modal -->
    <div id="expense-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Expense</h3>
                <button type="button" class="btn-close" id="close-expense-modal">‚úï</button>
            </div>

            <form id="expense-form">
                <div class="form-group">
                    <label>Amount</label>
                    <div class="amount-input-wrapper">
                        <span class="currency">‚Çπ</span>
                        <input type="number" id="expense-amount" placeholder="0" step="0.01" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>What's this for?</label>
                    <input type="text" id="expense-note" placeholder="e.g., Coffee, Dinner..." required>
                </div>

                <div class="form-group">
                    <label>Category</label>
                    <div class="category-grid">
                        <label class="category-option">
                            <input type="radio" name="category" value="food" required>
                            <span>üçï Food</span>
                        </label>
                        <label class="category-option">
                            <input type="radio" name="category" value="dates">
                            <span>üé¨ Dates</span>
                        </label>
                        <label class="category-option">
                            <input type="radio" name="category" value="gmasti">
                            <span>‚ò∫Ô∏è Gmasti</span>
                        </label>
                        <label class="category-option">
                            <input type="radio" name="category" value="gifts">
                            <span>üéÅ Gifts</span>
                        </label>
                        <label class="category-option">
                            <input type="radio" name="category" value="home">
                            <span>üè† Home</span>
                        </label>
                        <label class="category-option">
                            <input type="radio" name="category" value="misc">
                            <span>‚ú® Misc</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label>Split Type</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="splitType" value="equal" checked>
                            <span>50-50</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="splitType" value="custom">
                            <span>Custom</span>
                        </label>
                    </div>
                </div>

                <div id="custom-split" class="form-group hidden">
                    <label>Your Share (%)</label>
                    <input type="number" id="custom-split-amount" min="0" max="100" value="50">
                    <p class="form-hint">Partner will pay the remaining percentage</p>
                </div>

                <div class="form-group">
                    <label>Who paid?</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="paidBy" value="me" required>
                            <span id="paid-by-me-label">Me</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="paidBy" value="partner">
                            <span id="paid-by-partner-label">Partner</span>
                        </label>
                    </div>
                </div>

                <button type="submit" class="btn-primary">Add Expense</button>
            </form>
        </div>
    </div>

    <!-- Edit Expense Modal -->
    <div id="edit-expense-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Expense</h3>
                <button type="button" class="btn-close" id="close-edit-modal">‚úï</button>
            </div>

            <form id="edit-expense-form">
                <div class="form-group">
                    <label>Amount</label>
                    <div class="amount-input-wrapper">
                        <span class="currency">‚Çπ</span>
                        <input type="number" id="edit-expense-amount" placeholder="0" step="0.01" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>What's this for?</label>
                    <input type="text" id="edit-expense-note" placeholder="e.g., Coffee, Dinner..." required>
                </div>

                <div class="form-group">
                    <label>Category</label>
                    <div class="category-grid">
                        <label class="category-option">
                            <input type="radio" name="edit-category" value="food" required>
                            <span>üçï Food</span>
                        </label>
                        <label class="category-option">
                            <input type="radio" name="edit-category" value="dates">
                            <span>üé¨ Dates</span>
                        </label>
                        <label class="category-option">
                            <input type="radio" name="edit-category" value="gmasti">
                            <span>‚ò∫Ô∏è Gmasti</span>
                        </label>
                        <label class="category-option">
                            <input type="radio" name="edit-category" value="gifts">
                            <span>üéÅ Gifts</span>
                        </label>
                        <label class="category-option">
                            <input type="radio" name="edit-category" value="home">
                            <span>üè† Home</span>
                        </label>
                        <label class="category-option">
                            <input type="radio" name="edit-category" value="misc">
                            <span>‚ú® Misc</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label>Split Type</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="edit-splitType" value="equal">
                            <span>50-50</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="edit-splitType" value="custom">
                            <span>Custom</span>
                        </label>
                    </div>
                </div>

                <div id="edit-custom-split" class="form-group hidden">
                    <label>Your Share (%)</label>
                    <input type="number" id="edit-custom-split-amount" min="0" max="100" value="50">
                </div>

                <div class="form-group">
                    <label>Who paid?</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="edit-paidBy" value="me" required>
                            <span>Me</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="edit-paidBy" value="partner">
                            <span>Partner</span>
                        </label>
                    </div>
                </div>

                <button type="submit" class="btn-primary">Update Expense</button>
            </form>
        </div>
    </div>

    <!-- Budget Modal -->
    <div id="budget-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Set Monthly Budget</h3>
                <button type="button" class="btn-close" id="close-budget-modal">‚úï</button>
            </div>

            <form id="budget-form">
                <div class="form-group">
                    <label>Budget Limit</label>
                    <div class="amount-input-wrapper">
                        <span class="currency">‚Çπ</span>
                        <input type="number" id="budget-amount-input" placeholder="10000" step="100" required>
                    </div>
                </div>
                <button type="submit" class="btn-primary">Save Budget</button>
            </form>
        </div>
    </div>

    <!-- Memory Modal -->
    <div id="memory-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Memory</h3>
                <button type="button" class="btn-close" id="close-memory-modal">‚úï</button>
            </div>

            <div id="photo-selection" class="photo-selection">
                <button type="button" id="camera-btn" class="btn-secondary">üì∑ Take Photo</button>
                <button type="button" id="gallery-btn" class="btn-secondary">üñºÔ∏è From Gallery</button>
                <input type="file" id="camera-input" accept="image/*" capture="environment" style="display: none;">
                <input type="file" id="gallery-input" accept="image/*" multiple style="display: none;">
            </div>

            <div id="memory-preview" class="memory-preview hidden">
                <div id="preview-images" class="preview-images"></div>
                <button type="button" id="back-to-selection" class="btn-secondary">‚Üê Back</button>
            </div>

            <form id="memory-form" class="hidden">
                <div class="form-group">
                    <label for="memory-date">Date</label>
                    <input type="date" id="memory-date" required>
                </div>

                <div class="form-group">
                    <label for="memory-description">Memory Description (Optional)</label>
                    <input type="text" id="memory-description" placeholder="What was this about?">
                </div>

                <button type="submit" class="btn-primary">Save Memory</button>
            </form>
        </div>
    </div>

    <!-- Note Modal -->
    <div id="note-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Note</h3>
                <button type="button" class="btn-close" id="close-note-modal">‚úï</button>
            </div>

            <form id="note-form">
                <div class="form-group">
                    <label for="note-text">Your Note</label>
                    <textarea id="note-text" placeholder="What's on your mind?" rows="6" required></textarea>
                </div>

                <button type="submit" class="btn-primary">Save Note</button>
            </form>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loading" class="loading hidden">
        <div class="loading-spinner"></div>
    </div>

    <!-- Toast Messages -->
    <div id="toast" class="toast"></div>

    <!-- Easter Egg -->
    <div id="easter-egg" class="easter-egg hidden">
        <div class="easter-egg-content">
            I love you more üíï
        </div>
    </div>

    <script src="firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js"></script>
    <script src="app.js"></script>
</body>
</html>
